# Установка медиа-сервера MediaMTX для ретрансляции потоков с камер наблюдения

Установка производится со страницы релизов проекта MediaMTX
https://github.com/bluenviron/mediamtx/tags

На момент написания инструкции последней актуальной версией является v1.9.0. 

Установка медиа-сервера состоит из следующих шагов:
1. скачать архив из релиза подходящей платформы (в общем случае - amd64);
2. распаковать полученный архив;
3. перенести распакованный бинарный файл `mediamtx` в папку `/usr/local/bin`;
4. скопировать конфигурационный файл `mediamtx.yml` из текущей папки в `/usr/local/etc`;
5. создать папку `/var/log/mediamtx`;
6. скопировать описание службы systemd `mediamtx.service` из текущей папки в `/etc/systemd/system`;
7. запустить службу командой `systemctl start mediamtx`;
8. убедиться в успешном старте службы командой `systemctl status mediamtx`, служба должна быть активна;
9. добавить службу в автозапуск командой `systemctl enable mediamtx`

**Внимание!** Медиа-сервер использует порты TCP 8554 (RTSP), 8888 (HLS) и UDP 8000 (RTP), 8001 (RTCP). Предварительно необходимо убедиться, что эти порты доступны и не конфликтуют с уже запущенными приложениями, в противном случае необходимо переназначить их либо в конфликтующем приложении, либо в конфигурации MediaMTX (что, в свою очередь, может затронуть код frontend).

Возможен запуск службы от непривилегированного пользователя. В этом случае надо исправить файл описания службы (добавить параметр `User=имя_пользователя` в секцию `Service`) и убедиться в доступности для указанного пользователя каталога журналов `/var/log/mediamtx` на запись.


# Конфигурирация медиа-сервера

Конфигурация медиа-сервера расположена в файле `mediamtc.yml`

Разница между конфигурацией по умолчанию и используемой заключается в указании явного каталога для хранения лога, а также отключения механизмов публикации по протоколам RTMP, WebRTC и SRT:

```diff
14c14
< logFile: mediamtx.log
---
> logFile: /var/log/mediamtx/mediamtx.log
263c263
< rtmp: yes
---
> rtmp: no
342c342
< webrtc: yes
---
> webrtc: no
395c395
< srt: yes
---
> srt: no
```
